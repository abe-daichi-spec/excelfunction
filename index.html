<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Excel関数スペル練習</title>
<style>
:root{
  --bg:#0b1020; --card:#111a33; --text:#eef2ff; --muted:#a6b0d6;
  --btn:#1b2a55; --btn2:#263a77; --radius:16px;
}
body{margin:0;font-family:sans-serif;background:var(--bg);color:var(--text);}
.wrap{max-width:920px;margin:auto;padding:18px;}
.card{background:var(--card);border-radius:var(--radius);padding:16px;margin-bottom:14px;}
.q{font-size:24px;font-weight:bold;margin:8px 0;}
.input{background:#0c1430;padding:12px;border-radius:12px;margin-top:10px;}
button{margin:4px;padding:10px 14px;border-radius:10px;border:0;background:var(--btn);color:white;font-weight:bold;}
button:hover{background:var(--btn2);}
.log{margin-top:10px;color:#ccc;white-space:pre-wrap;}
</style>
</head>
<body>
<div class="wrap">

<div class="card">
<h2>問題（説明 → 関数名）</h2>
<div class="q" id="question">—</div>
<div class="input" id="typed"></div>

<button onclick="check()">判定</button>
<button onclick="nextQ()">次の問題</button>
<button onclick="clearTyped()">クリア</button>
<button onclick="hint()">ヒント</button>

<div class="log" id="feedback"></div>
</div>

<div class="card">
<h2>出題範囲</h2>
<button id="btnToggleRange">出題範囲を表示</button>
<div class="log" id="listBox" style="display:none;"></div>
</div>

</div>

<script>
// ===== 先生用設定 =====
const SHOW_ANSWER_BOX = false; // ← true にすると関数名も表示

// ===== 出題データ =====
const ITEMS = [
{func:"MODE",desc:"最も多く出現する値（最頻値）を求める関数"},
{func:"ABS",desc:"数値の絶対値を求める関数"},
{func:"SUMIFS",desc:"複数条件に合うセルの合計を求める関数"},
{func:"AVERAGEIFS",desc:"複数条件に合うセルの平均を求める関数"},
{func:"COUNTIFS",desc:"複数条件に合うセルの個数を数える関数"},
{func:"MEDIAN",desc:"中央値を求める関数"},
{func:"IFERROR",desc:"エラー時に指定した値を返す関数"},
{func:"SUBSTITUTE",desc:"文字列の一部を置換する関数"},
{func:"RANDBETWEEN",desc:"指定範囲の乱数を返す関数"},
{func:"FORECAST",desc:"既存データから将来の値を予測する関数"}
];

let pool = [];
let current = null;
let typed = "";
let rangeVisible = false;

// ===== 初期化 =====
function shuffle(arr){return arr.sort(()=>Math.random()-0.5);}
function refill(){ pool = shuffle([...ITEMS]); }
function nextQ(){
  if(pool.length===0) refill();
  current = pool.pop();
  typed="";
  render();
}

function render(){
  document.getElementById("question").textContent = current.desc;
  document.getElementById("typed").textContent = typed;
  document.getElementById("feedback").textContent = "";

  // 出題範囲表示（B案）
  document.getElementById("listBox").textContent =
    ITEMS.map(x => `・${x.desc}${SHOW_ANSWER_BOX ? " → " + x.func : ""}`).join("\n");
}

function typeChar(c){ typed += c; render(); }
function clearTyped(){ typed=""; render(); }

function hint(){
  document.getElementById("feedback").textContent =
    "ヒント：" + current.func.slice(0,2) + "…";
}

function check(){
  if(typed.toUpperCase()===current.func){
    document.getElementById("feedback").textContent = "✅ 正解！";
    setTimeout(nextQ,600);
  }else{
    document.getElementById("feedback").textContent = "❌ 不正解";
  }
}

// ===== 出題範囲 表示ボタン =====
document.getElementById("btnToggleRange").addEventListener("click",()=>{
  rangeVisible=!rangeVisible;
  document.getElementById("listBox").style.display = rangeVisible?"block":"none";
  document.getElementById("btnToggleRange").textContent =
    rangeVisible?"出題範囲を非表示":"出題範囲を表示";
});

// ===== キーボード入力対応 =====
window.addEventListener("keydown",e=>{
  if(e.key==="Enter") check();
  else if(e.key==="Backspace"){ typed=typed.slice(0,-1); render(); }
  else if(/^[a-zA-Z]$/.test(e.key)){ typeChar(e.key.toUpperCase()); }
});

// 起動
refill();
nextQ();
</script>
</body>
</html>

